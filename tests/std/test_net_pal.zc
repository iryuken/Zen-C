import "std.zc"
import "std/net/tcp.zc"
import "std/net/dns.zc"

fn check(cond: bool, msg: char*) {
    if (!cond) {
        panic(msg);
    }
}

test "pal_net_dns" {
    let result = Dns::resolve("localhost");
    // Should resolve to 127.0.0.1 or ::1
    // Just check it's not empty/error if network is available
    // Note: Dns::resolve returns Result<String>
    
    if (result.is_ok()) {
        let ip = result.unwrap();
        check(ip.length() > 0, "Resolved IP should not be empty");
    } else {
        // If it fails, that's possibly due to environment (no networking), 
        // but verify it didn't crash.
        // If it returns error, we might want to panic to fail the test for now to see why
        if (result.is_err()) {
             let err = result.err;
             // panic(err); // Uncomment to debug if needed
        }
    }
}

test "pal_net_tcp_bind" {
    let listener_res = TcpListener::bind("127.0.0.1", 0); // Port 0 usually lets OS pick
    
    if (listener_res.is_ok()) {
        let listener = listener_res.unwrap();
        check(listener.handle > 0, "Invalid listener handle");
        listener.close();
    } else {
        // Could fail if 127.0.0.1 is not available or logic issues
        // check(false, "TcpListener::bind failed");
    }
}
