import "std.zc"
import "std/fs.zc"

fn check(cond: bool, msg: char*) {
    if (!cond) {
        panic(msg);
    }
}

test "pal_fs_basic" {
    // Create a temporary directory
    let test_dir = "test_pal_fs_dir";
    if (File::exists(test_dir)) {
        // Cleanup potentially leftover file
        let file_path = "test_pal_fs_dir/test.txt";
        if (File::exists(file_path)) {
            let _ = File::remove_file(file_path);
        }
        let _ = File::remove_dir(test_dir);
    }
    
    check(!File::exists(test_dir), "Test dir should not exist initially");
    
    // Test mkdir
    let res = File::create_dir(test_dir);
    check(res.is_ok(), "mkdir should succeed");
    check(File::exists(test_dir), "Test dir should exist after mkdir");
    
    // Test file write using File instance methods
    let file_path = "test_pal_fs_dir/test.txt";
    let content = "Hello, PAL FS!";
    
    let f_res = File::open(file_path, "w");
    check(f_res.is_ok(), "File::open for write should succeed");
    
    let f = f_res.unwrap();
    let w_res = f.write_string(content);
    check(w_res.is_ok(), "File::write_string should succeed");
    f.close();
    
    check(File::exists(file_path), "File should exist after write");
    
    // Test file read
    let r_res = File::read_all(file_path);
    check(r_res.is_ok(), "File::read_all should succeed");
    
    let read_content = r_res.unwrap();
    // Basic string check
    check(read_content.length() > 0, "Read content should not be empty");
    
    // Clean up
    let rm_res = File::remove_file(file_path);
    check(rm_res.is_ok(), "File::remove_file should succeed");
    
    let rmd_res = File::remove_dir(test_dir);
    check(rmd_res.is_ok(), "File::remove_dir should succeed");
    
    check(!File::exists(test_dir), "Test dir should be gone");
}
